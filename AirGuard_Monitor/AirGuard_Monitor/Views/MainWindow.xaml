<Window
    x:Class="AirGuard.WPF.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="AIRGUARD — 드론 관제 시스템"
    Height="900"
    Width="1600"
    MinHeight="700"
    MinWidth="1200"
    WindowState="Maximized"
    Background="#0A0C0F">

    <Window.Resources>
        <SolidColorBrush
            x:Key="BgSecondary"
            Color="#0F1318" />
        <SolidColorBrush
            x:Key="BgPanel"
            Color="#141920" />
        <SolidColorBrush
            x:Key="BorderColor"
            Color="#1E3A5F" />
        <SolidColorBrush
            x:Key="AccentBlue"
            Color="#0D7FFF" />
        <SolidColorBrush
            x:Key="AccentCyan"
            Color="#00D4FF" />
        <SolidColorBrush
            x:Key="AccentRed"
            Color="#FF3B3B" />
        <SolidColorBrush
            x:Key="TextPrimary"
            Color="#E8F4FF" />
        <SolidColorBrush
            x:Key="TextSecondary"
            Color="#7A9BB5" />
        <SolidColorBrush
            x:Key="TextMuted"
            Color="#3D5A73" />

        <Style
            TargetType="TextBlock">
            <Setter
                Property="Foreground"
                Value="{StaticResource TextPrimary}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
        </Style>
        <Style
            x:Key="SectionHeader"
            TargetType="TextBlock">
            <Setter
                Property="Foreground"
                Value="{StaticResource AccentCyan}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="10" />
            <Setter
                Property="FontWeight"
                Value="Bold" />
        </Style>
        <Style
            x:Key="MetricValue"
            TargetType="TextBlock">
            <Setter
                Property="Foreground"
                Value="{StaticResource AccentCyan}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="16" />
            <Setter
                Property="FontWeight"
                Value="Bold" />
        </Style>
        <Style
            x:Key="MetricLabel"
            TargetType="TextBlock">
            <Setter
                Property="Foreground"
                Value="{StaticResource TextSecondary}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="9" />
        </Style>
        <Style
            x:Key="PanelBorder"
            TargetType="Border">
            <Setter
                Property="Background"
                Value="{StaticResource BgPanel}" />
            <Setter
                Property="BorderBrush"
                Value="{StaticResource BorderColor}" />
            <Setter
                Property="BorderThickness"
                Value="1" />
            <Setter
                Property="CornerRadius"
                Value="2" />
        </Style>
        <Style
            x:Key="ConnectBtn"
            TargetType="Button">
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="11" />
            <Setter
                Property="FontWeight"
                Value="Bold" />
            <Setter
                Property="Foreground"
                Value="White" />
            <Setter
                Property="BorderThickness"
                Value="0" />
            <Setter
                Property="Padding"
                Value="14,6" />
            <Setter
                Property="Cursor"
                Value="Hand" />
            <Setter
                Property="Template">
                <Setter.Value>
                    <ControlTemplate
                        TargetType="Button">
                        <Border
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}"
                            CornerRadius="2">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger
                                Property="IsMouseOver"
                                Value="True">
                                <Setter
                                    Property="Opacity"
                                    Value="0.8" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style
            TargetType="TextBox">
            <Setter
                Property="Background"
                Value="#0F1318" />
            <Setter
                Property="Foreground"
                Value="{StaticResource AccentCyan}" />
            <Setter
                Property="BorderBrush"
                Value="{StaticResource BorderColor}" />
            <Setter
                Property="BorderThickness"
                Value="1" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="12" />
            <Setter
                Property="Padding"
                Value="6,4" />
            <Setter
                Property="CaretBrush"
                Value="{StaticResource AccentCyan}" />
        </Style>
        <Style
            TargetType="ComboBox">
            <Setter
                Property="Background"
                Value="#0F1318" />
            <Setter
                Property="Foreground"
                Value="{StaticResource AccentCyan}" />
            <Setter
                Property="BorderBrush"
                Value="{StaticResource BorderColor}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="11" />
            <Setter
                Property="Padding"
                Value="4,3" />
        </Style>
        <Style
            TargetType="DataGrid">
            <Setter
                Property="Background"
                Value="Transparent" />
            <Setter
                Property="Foreground"
                Value="{StaticResource TextPrimary}" />
            <Setter
                Property="BorderThickness"
                Value="0" />
            <Setter
                Property="GridLinesVisibility"
                Value="Horizontal" />
            <Setter
                Property="HorizontalGridLinesBrush"
                Value="#1A2535" />
            <Setter
                Property="RowBackground"
                Value="Transparent" />
            <Setter
                Property="AlternatingRowBackground"
                Value="#0D1520" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="12" />
            <Setter
                Property="SelectionMode"
                Value="Single" />
            <Setter
                Property="ColumnHeaderHeight"
                Value="30" />
            <Setter
                Property="RowHeight"
                Value="28" />
        </Style>
        <Style
            TargetType="DataGridColumnHeader">
            <Setter
                Property="Background"
                Value="#0A1220" />
            <Setter
                Property="Foreground"
                Value="{StaticResource AccentCyan}" />
            <Setter
                Property="FontFamily"
                Value="Consolas" />
            <Setter
                Property="FontSize"
                Value="10" />
            <Setter
                Property="FontWeight"
                Value="Bold" />
            <Setter
                Property="Padding"
                Value="10,0" />
            <Setter
                Property="BorderBrush"
                Value="#1E3A5F" />
            <Setter
                Property="BorderThickness"
                Value="0,0,1,1" />
        </Style>
        <Style
            TargetType="DataGridRow">
            <Setter
                Property="Foreground"
                Value="{StaticResource TextPrimary}" />
            <Style.Triggers>
                <Trigger
                    Property="IsSelected"
                    Value="True">
                    <Setter
                        Property="Background"
                        Value="#0D3366" />
                </Trigger>
                <Trigger
                    Property="IsMouseOver"
                    Value="True">
                    <Setter
                        Property="Background"
                        Value="#0A2040" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style
            TargetType="DataGridCell">
            <Setter
                Property="BorderThickness"
                Value="0" />
            <Setter
                Property="Padding"
                Value="0" />
            <Setter
                Property="Template">
                <Setter.Value>
                    <ControlTemplate
                        TargetType="DataGridCell">
                        <Border
                            Padding="10,0"
                            Background="{TemplateBinding Background}">
                            <ContentPresenter
                                VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style
            TargetType="ScrollBar">
            <Setter
                Property="Background"
                Value="#0F1318" />
            <Setter
                Property="Width"
                Value="5" />
        </Style>
    </Window.Resources>

    <!-- 루트 Grid: 긴급 플래시 오버레이 포함 -->
    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition
                    Height="50" />
                <RowDefinition
                    Height="*" />
                <RowDefinition
                    Height="26" />
            </Grid.RowDefinitions>

            <!-- ===== TOP BAR ===== -->
            <Border
                Grid.Row="0"
                Background="#080B0F"
                BorderBrush="#1E3A5F"
                BorderThickness="0,0,0,1">
                <Grid
                    Margin="14,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="*" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                        <ColumnDefinition
                            Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 로고 -->
                    <StackPanel
                        Grid.Column="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                        <Border
                            Width="26"
                            Height="26"
                            Background="#0D7FFF"
                            CornerRadius="2"
                            Margin="0,0,10,0">
                            <TextBlock
                                Text="▲"
                                FontSize="13"
                                FontWeight="Bold"
                                Foreground="White"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                        <StackPanel
                            VerticalAlignment="Center">
                            <TextBlock
                                Text="AIRGUARD"
                                FontSize="15"
                                FontWeight="Bold"
                                Foreground="{StaticResource TextPrimary}" />
                            <TextBlock
                                Text="DRONE CONTROL SYSTEM"
                                FontSize="8"
                                Foreground="{StaticResource TextMuted}" />
                        </StackPanel>
                    </StackPanel>

                    <Rectangle
                        Grid.Column="1"
                        Width="1"
                        Height="28"
                        Fill="#1E3A5F"
                        Margin="18,0" />

                    <!-- 연결 설정 -->
                    <StackPanel
                        Grid.Column="2"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="8,0">
                        <TextBlock
                            Text="SERVER"
                            VerticalAlignment="Center"
                            Margin="0,0,6,0"
                            Foreground="{StaticResource TextMuted}"
                            FontSize="9" />
                        <TextBox
                            Width="130"
                            VerticalAlignment="Center"
                            Text="{Binding ServerAddress, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock
                            Text="PORT"
                            VerticalAlignment="Center"
                            Margin="10,0,6,0"
                            Foreground="{StaticResource TextMuted}"
                            FontSize="9" />
                        <TextBox
                            Width="58"
                            VerticalAlignment="Center"
                            Text="{Binding ServerPort, UpdateSourceTrigger=PropertyChanged}" />
                        <Button
                            Style="{StaticResource ConnectBtn}"
                            Content="{Binding ConnectButtonText}"
                            Background="{Binding ConnectButtonColor}"
                            Command="{Binding ToggleConnectCommand}"
                            Margin="10,0,0,0"
                            VerticalAlignment="Center" />
                        <!-- CSV 로그 버튼 -->
                        <Button
                            Style="{StaticResource ConnectBtn}"
                            Content="{Binding CsvButtonText}"
                            Background="{Binding CsvButtonColor}"
                            Command="{Binding ToggleCsvCommand}"
                            Margin="6,0,0,0"
                            VerticalAlignment="Center" />
                        <TextBlock
                            Text="{Binding CsvStatus}"
                            VerticalAlignment="Center"
                            Margin="8,0,0,0"
                            FontSize="9"
                            Foreground="{StaticResource TextMuted}" />
                    </StackPanel>

                    <!-- 시각 -->
                    <StackPanel
                        Grid.Column="3"
                        VerticalAlignment="Center"
                        Margin="0,0,18,0">
                        <TextBlock
                            Text="{Binding CurrentTime}"
                            FontSize="17"
                            FontWeight="Bold"
                            Foreground="{StaticResource AccentCyan}"
                            HorizontalAlignment="Right" />
                        <TextBlock
                            Text="{Binding CurrentDate}"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}"
                            HorizontalAlignment="Right" />
                    </StackPanel>

                    <!-- 세션 시간 -->
                    <StackPanel
                        Grid.Column="4"
                        VerticalAlignment="Center"
                        Margin="0,0,12,0">
                        <TextBlock
                            Text="{Binding SessionDuration}"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}"
                            HorizontalAlignment="Right" />
                    </StackPanel>

                    <!-- 연결 상태 -->
                    <Border
                        Grid.Column="5"
                        BorderBrush="{StaticResource BorderColor}"
                        BorderThickness="1"
                        Padding="10,5"
                        CornerRadius="2"
                        VerticalAlignment="Center">
                        <StackPanel
                            Orientation="Horizontal">
                            <Ellipse
                                Width="7"
                                Height="7"
                                VerticalAlignment="Center"
                                Margin="0,0,7,0"
                                Fill="{Binding ConnectionIndicatorColor}" />
                            <TextBlock
                                Text="{Binding StatusText}"
                                FontSize="10"
                                Foreground="{StaticResource TextSecondary}" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- ===== MAIN CONTENT ===== -->
            <Grid
                Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition
                        Width="255" />
                    <ColumnDefinition
                        Width="*" />
                    <ColumnDefinition
                        Width="320" />
                </Grid.ColumnDefinitions>

                <!-- ===== 좌측 패널 ===== -->
                <Grid
                    Grid.Column="0"
                    Background="{StaticResource BgSecondary}">
                    <Grid.RowDefinitions>
                        <RowDefinition
                            Height="Auto" />
                        <RowDefinition
                            Height="*" />
                        <RowDefinition
                            Height="210" />
                    </Grid.RowDefinitions>

                    <!-- 헤더 -->
                    <Border
                        Grid.Row="0"
                        Padding="12,10"
                        BorderBrush="#1E3A5F"
                        BorderThickness="0,0,1,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition
                                    Width="*" />
                                <ColumnDefinition
                                    Width="Auto" />
                                <ColumnDefinition
                                    Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock
                                    Text="ACTIVE UNITS"
                                    Style="{StaticResource SectionHeader}" />
                                <TextBlock
                                    Text="{Binding VehicleCountText}"
                                    FontSize="10"
                                    Foreground="{StaticResource TextSecondary}"
                                    Margin="0,2,0,0" />
                            </StackPanel>
                            <ComboBox
                                Grid.Column="1"
                                Width="75"
                                ItemsSource="{Binding FilterOptions}"
                                SelectedItem="{Binding SelectedFilter}"
                                VerticalAlignment="Center" />
                            <!-- 유닛 초기화 버튼 -->
                            <Button
                                Grid.Column="2"
                                Content="CLR"
                                Margin="4,0,0,0"
                                Style="{StaticResource ConnectBtn}"
                                Background="#1A2535"
                                FontSize="9"
                                Padding="6,3"
                                Command="{Binding ClearVehiclesCommand}"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Border>

                    <!-- 드론 카드 목록 -->
                    <ScrollViewer
                        Grid.Row="1"
                        VerticalScrollBarVisibility="Auto"
                        BorderBrush="#1E3A5F"
                        BorderThickness="0,0,1,0">
                        <ItemsControl
                            ItemsSource="{Binding Vehicles}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Margin="0,1,0,0"
                                        Padding="12,9"
                                        Cursor="Hand"
                                        BorderThickness="3,0,0,0"
                                        BorderBrush="{Binding StatusAccentColor}"
                                        Background="{Binding SelectionBackground}">
                                        <Border.InputBindings>
                                            <MouseBinding
                                                MouseAction="LeftClick"
                                                Command="{Binding DataContext.SelectVehicleCommand,
                                                    RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}" />
                                        </Border.InputBindings>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition
                                                    Height="Auto" />
                                                <RowDefinition
                                                    Height="Auto" />
                                                <RowDefinition
                                                    Height="Auto" />
                                                <RowDefinition
                                                    Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <!-- 이름 + 상태 뱃지 -->
                                            <Grid
                                                Grid.Row="0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width="*" />
                                                    <ColumnDefinition
                                                        Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Text="{Binding Name}"
                                                    FontWeight="Bold"
                                                    FontSize="12"
                                                    Foreground="{StaticResource TextPrimary}" />
                                                <Border
                                                    Grid.Column="1"
                                                    Padding="5,2"
                                                    CornerRadius="2"
                                                    Background="{Binding StatusBadgeColor}">
                                                    <TextBlock
                                                        Text="{Binding Status}"
                                                        FontSize="8"
                                                        FontWeight="Bold"
                                                        Foreground="White" />
                                                </Border>
                                            </Grid>
                                            <!-- ID + 임무 -->
                                            <Grid
                                                Grid.Row="1"
                                                Margin="0,2,0,4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width="*" />
                                                    <ColumnDefinition
                                                        Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Text="{Binding VehicleId}"
                                                    FontSize="9"
                                                    Foreground="{StaticResource TextMuted}" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    Text="{Binding MissionStatus}"
                                                    FontSize="8"
                                                    Foreground="{Binding StatusAccentColor}" />
                                            </Grid>
                                            <!-- 배터리 바 -->
                                            <Grid
                                                Grid.Row="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width="*" />
                                                    <ColumnDefinition
                                                        Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <Border
                                                    Height="4"
                                                    Background="#1A2535"
                                                    CornerRadius="1">
                                                    <Border
                                                        Height="4"
                                                        Background="{Binding BatteryColor}"
                                                        CornerRadius="1"
                                                        HorizontalAlignment="Left"
                                                        Width="{Binding BatteryBarWidth}" />
                                                </Border>
                                                <TextBlock
                                                    Grid.Column="1"
                                                    Text="{Binding Battery, StringFormat={}{0:F0}%}"
                                                    FontSize="9"
                                                    Margin="5,0,0,0"
                                                    Foreground="{Binding BatteryColor}" />
                                            </Grid>
                                            <!-- 속도 + 고도 -->
                                            <Grid
                                                Grid.Row="3"
                                                Margin="0,3,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width="*" />
                                                    <ColumnDefinition
                                                        Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel
                                                    Orientation="Horizontal">
                                                    <TextBlock
                                                        Text="SPD "
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextMuted}" />
                                                    <TextBlock
                                                        Text="{Binding SpeedText}"
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextSecondary}" />
                                                </StackPanel>
                                                <StackPanel
                                                    Grid.Column="1"
                                                    Orientation="Horizontal">
                                                    <TextBlock
                                                        Text="ALT "
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextMuted}" />
                                                    <TextBlock
                                                        Text="{Binding Altitude, StringFormat=F1}"
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextSecondary}" />
                                                    <TextBlock
                                                        Text="m"
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextMuted}" />
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- 검색 + QUICK STATS -->
                    <Border
                        Grid.Row="2"
                        BorderBrush="#1E3A5F"
                        BorderThickness="0,1,1,0"
                        Padding="12,10">
                        <StackPanel>
                            <TextBlock
                                Text="SEARCH"
                                Style="{StaticResource SectionHeader}"
                                Margin="0,0,0,6" />
                            <TextBox
                                Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" />
                            <Rectangle
                                Height="1"
                                Fill="#1E3A5F"
                                Margin="0,10,0,8" />
                            <TextBlock
                                Text="QUICK STATS"
                                Style="{StaticResource SectionHeader}"
                                Margin="0,0,0,6" />
                            <ItemsControl
                                ItemsSource="{Binding QuickStats}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid
                                            Margin="0,3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition
                                                    Width="*" />
                                                <ColumnDefinition
                                                    Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock
                                                Text="{Binding Label}"
                                                FontSize="10"
                                                Foreground="{StaticResource TextMuted}" />
                                            <TextBlock
                                                Grid.Column="1"
                                                Text="{Binding Value}"
                                                FontSize="10"
                                                FontWeight="Bold"
                                                Foreground="{Binding Color}" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- ===== 중앙 ===== -->
                <Grid
                    Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition
                            Height="*" />
                        <RowDefinition
                            Height="200" />
                    </Grid.RowDefinitions>

                    <!-- 지도 -->
                    <Border
                        Grid.Row="0"
                        Background="#080E16"
                        BorderBrush="#1E3A5F"
                        BorderThickness="1">
                        <Grid>
                            <Canvas
                                x:Name="MapCanvas"
                                ClipToBounds="True"
                                MouseMove="MapCanvas_MouseMove"
                                MouseWheel="MapCanvas_MouseWheel"
                                MouseLeftButtonDown="MapCanvas_MouseLeftButtonDown"
                                MouseLeftButtonUp="MapCanvas_MouseLeftButtonUp">
                                <Canvas.Background>
                                    <DrawingBrush
                                        TileMode="Tile"
                                        Viewport="0,0,40,40"
                                        ViewportUnits="Absolute">
                                        <DrawingBrush.Drawing>
                                            <GeometryDrawing>
                                                <GeometryDrawing.Pen>
                                                    <Pen
                                                        Brush="#0C1820"
                                                        Thickness="0.5" />
                                                </GeometryDrawing.Pen>
                                                <GeometryDrawing.Geometry>
                                                    <GeometryGroup>
                                                        <LineGeometry
                                                            StartPoint="0,0"
                                                            EndPoint="40,0" />
                                                        <LineGeometry
                                                            StartPoint="0,0"
                                                            EndPoint="0,40" />
                                                    </GeometryGroup>
                                                </GeometryDrawing.Geometry>
                                            </GeometryDrawing>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Canvas.Background>

                                <ItemsControl
                                    ItemsSource="{Binding Vehicles}"
                                    Panel.ZIndex="10">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Canvas>
                                                <Polyline
                                                    Points="{Binding PathPoints}"
                                                    Stroke="{Binding StatusAccentColor}"
                                                    StrokeThickness="1"
                                                    Opacity="0.35"
                                                    StrokeDashArray="4,2" />
                                                <Canvas
                                                    Canvas.Left="{Binding MapX}"
                                                    Canvas.Top="{Binding MapY}">
                                                    <Ellipse
                                                        Width="36"
                                                        Height="36"
                                                        Canvas.Left="-18"
                                                        Canvas.Top="-18"
                                                        Stroke="{Binding StatusAccentColor}"
                                                        StrokeThickness="1"
                                                        Opacity="0.4"
                                                        Visibility="{Binding SelectionRingVisibility}" />
                                                    <Ellipse
                                                        Width="11"
                                                        Height="11"
                                                        Canvas.Left="-5.5"
                                                        Canvas.Top="-5.5"
                                                        Fill="{Binding StatusAccentColor}"
                                                        Stroke="#0A0C0F"
                                                        StrokeThickness="2" />
                                                    <Border
                                                        Canvas.Left="10"
                                                        Canvas.Top="-9"
                                                        Background="#CC080E16"
                                                        Padding="4,2">
                                                        <TextBlock
                                                            Text="{Binding Name}"
                                                            FontSize="9"
                                                            FontWeight="Bold"
                                                            Foreground="{Binding StatusAccentColor}" />
                                                    </Border>
                                                </Canvas>
                                            </Canvas>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Canvas>

                            <Border
                                VerticalAlignment="Top"
                                HorizontalAlignment="Left"
                                Margin="10"
                                Background="#CC080E16"
                                BorderBrush="#1E3A5F"
                                BorderThickness="1"
                                Padding="8,6"
                                IsHitTestVisible="False">
                                <StackPanel>
                                    <TextBlock
                                        Text="TACTICAL MAP"
                                        Style="{StaticResource SectionHeader}" />
                                    <TextBlock
                                        Text="{Binding MapCoordinateText}"
                                        FontSize="9"
                                        Foreground="{StaticResource TextSecondary}"
                                        Margin="0,3,0,0" />
                                    <TextBlock
                                        Text="{Binding MapZoomText}"
                                        FontSize="9"
                                        Foreground="{StaticResource TextMuted}" />
                                </StackPanel>
                            </Border>

                            <Border
                                VerticalAlignment="Bottom"
                                HorizontalAlignment="Right"
                                Margin="10"
                                Background="#CC080E16"
                                BorderBrush="#1E3A5F"
                                BorderThickness="1"
                                Padding="10,8"
                                IsHitTestVisible="False">
                                <StackPanel>
                                    <TextBlock
                                        Text="LEGEND"
                                        Style="{StaticResource SectionHeader}"
                                        Margin="0,0,0,5" />
                                    <StackPanel
                                        Orientation="Horizontal"
                                        Margin="0,2">
                                        <Ellipse
                                            Width="7"
                                            Height="7"
                                            Fill="#00FF88"
                                            Margin="0,0,6,0"
                                            VerticalAlignment="Center" />
                                        <TextBlock
                                            Text="ACTIVE"
                                            FontSize="9"
                                            Foreground="{StaticResource TextSecondary}" />
                                    </StackPanel>
                                    <StackPanel
                                        Orientation="Horizontal"
                                        Margin="0,2">
                                        <Ellipse
                                            Width="7"
                                            Height="7"
                                            Fill="#7A9BB5"
                                            Margin="0,0,6,0"
                                            VerticalAlignment="Center" />
                                        <TextBlock
                                            Text="IDLE"
                                            FontSize="9"
                                            Foreground="{StaticResource TextSecondary}" />
                                    </StackPanel>
                                    <StackPanel
                                        Orientation="Horizontal"
                                        Margin="0,2">
                                        <Ellipse
                                            Width="7"
                                            Height="7"
                                            Fill="#FF3B3B"
                                            Margin="0,0,6,0"
                                            VerticalAlignment="Center" />
                                        <TextBlock
                                            Text="EMERGENCY"
                                            FontSize="9"
                                            Foreground="{StaticResource TextSecondary}" />
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- FLEET STATUS DataGrid -->
                    <Border
                        Grid.Row="1"
                        Background="{StaticResource BgSecondary}"
                        BorderBrush="#1E3A5F"
                        BorderThickness="0,1,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition
                                    Height="30" />
                                <RowDefinition
                                    Height="*" />
                            </Grid.RowDefinitions>
                            <Border
                                Grid.Row="0"
                                Background="#080B0F"
                                Padding="12,0">
                                <StackPanel
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                                    <TextBlock
                                        Text="FLEET STATUS"
                                        Style="{StaticResource SectionHeader}"
                                        VerticalAlignment="Center" />
                                    <Rectangle
                                        Width="1"
                                        Height="14"
                                        Fill="#1E3A5F"
                                        Margin="10,0" />
                                    <TextBlock
                                        Text="{Binding LastUpdateText}"
                                        FontSize="9"
                                        Foreground="{StaticResource TextMuted}"
                                        VerticalAlignment="Center" />
                                    <Rectangle
                                        Width="1"
                                        Height="14"
                                        Fill="#1E3A5F"
                                        Margin="10,0" />
                                    <TextBlock
                                        Text="{Binding DataRate}"
                                        FontSize="9"
                                        Foreground="{StaticResource TextSecondary}"
                                        VerticalAlignment="Center" />
                                </StackPanel>
                            </Border>
                            <DataGrid
                                Grid.Row="1"
                                ItemsSource="{Binding Vehicles}"
                                SelectedItem="{Binding SelectedVehicle}"
                                Foreground="#E8F4FF"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                CanUserAddRows="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn
                                        Header="UNIT ID"
                                        Binding="{Binding VehicleId}"
                                        Width="85" />
                                    <DataGridTextColumn
                                        Header="NAME"
                                        Binding="{Binding Name}"
                                        Width="100" />
                                    <DataGridTemplateColumn
                                        Header="STATUS"
                                        Width="85">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border
                                                    Padding="5,2"
                                                    CornerRadius="2"
                                                    HorizontalAlignment="Left"
                                                    Background="{Binding StatusBadgeColor}">
                                                    <TextBlock
                                                        Text="{Binding Status}"
                                                        FontSize="9"
                                                        FontWeight="Bold"
                                                        Foreground="White" />
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn
                                        Header="LAT"
                                        Binding="{Binding Latitude,  StringFormat=F4}"
                                        Width="80" />
                                    <DataGridTextColumn
                                        Header="LON"
                                        Binding="{Binding Longitude, StringFormat=F4}"
                                        Width="80" />
                                    <DataGridTextColumn
                                        Header="ALT(m)"
                                        Binding="{Binding Altitude,  StringFormat=F1}"
                                        Width="65" />
                                    <DataGridTextColumn
                                        Header="SPD(m/s)"
                                        Binding="{Binding Speed,     StringFormat=F1}"
                                        Width="70" />
                                    <DataGridTemplateColumn
                                        Header="BATTERY"
                                        Width="110">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition
                                                            Width="*" />
                                                        <ColumnDefinition
                                                            Width="36" />
                                                    </Grid.ColumnDefinitions>
                                                    <ProgressBar
                                                        Value="{Binding Battery}"
                                                        Maximum="100"
                                                        Height="6"
                                                        Background="#1A2535"
                                                        Foreground="{Binding BatteryColor}"
                                                        BorderThickness="0"
                                                        VerticalAlignment="Center" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Text="{Binding Battery, StringFormat={}{0:F0}%}"
                                                        FontSize="9"
                                                        Margin="4,0,0,0"
                                                        Foreground="{Binding BatteryColor}"
                                                        VerticalAlignment="Center" />
                                                </Grid>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn
                                        Header="HEADING"
                                        Binding="{Binding HeadingText}"
                                        Width="65" />
                                    <DataGridTextColumn
                                        Header="TIMESTAMP"
                                        Binding="{Binding TimestampText}"
                                        Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                </Grid>

                <!-- ===== 우측 패널 ===== -->
                <Grid
                    Grid.Column="2"
                    Background="{StaticResource BgSecondary}">
                    <Grid.RowDefinitions>
                        <RowDefinition
                            Height="Auto" />
                        <RowDefinition
                            Height="180" />
                        <RowDefinition
                            Height="*" />
                        <RowDefinition
                            Height="*" />
                    </Grid.RowDefinitions>

                    <!-- UNIT DETAIL -->
                    <Border
                        Grid.Row="0"
                        BorderBrush="#1E3A5F"
                        BorderThickness="1,0,0,1"
                        Padding="13,12">
                        <StackPanel>
                            <TextBlock
                                Text="UNIT DETAIL"
                                Style="{StaticResource SectionHeader}"
                                Margin="0,0,0,10" />

                            <TextBlock
                                Text="— 드론을 선택하세요 —"
                                FontSize="10"
                                Foreground="{StaticResource TextMuted}"
                                Visibility="{Binding NoSelectionVisibility}" />

                            <StackPanel
                                Visibility="{Binding SelectedVehicleVisibility}">
                                <!-- 이름 + 상태 -->
                                <Grid
                                    Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition
                                            Width="*" />
                                        <ColumnDefinition
                                            Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Text="{Binding SelectedVehicle.Name}"
                                        FontSize="14"
                                        FontWeight="Bold"
                                        Foreground="{StaticResource TextPrimary}" />
                                    <Border
                                        Grid.Column="1"
                                        Padding="6,2"
                                        CornerRadius="2"
                                        Background="{Binding SelectedVehicle.StatusBadgeColor}">
                                        <TextBlock
                                            Text="{Binding SelectedVehicle.Status}"
                                            FontSize="9"
                                            FontWeight="Bold"
                                            Foreground="White" />
                                    </Border>
                                </Grid>
                                <TextBlock
                                    Text="{Binding SelectedVehicle.VehicleId}"
                                    FontSize="9"
                                    Foreground="{StaticResource TextMuted}"
                                    Margin="0,0,0,8" />

                                <!-- 수치 그리드 -->
                                <UniformGrid
                                    Columns="2"
                                    Margin="0,0,0,6">
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="0,0,2,2"
                                        Padding="8,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="ALTITUDE"
                                                Style="{StaticResource MetricLabel}" />
                                            <StackPanel
                                                Orientation="Horizontal"
                                                Margin="0,1,0,0">
                                                <TextBlock
                                                    Text="{Binding SelectedVehicle.Altitude, StringFormat=F1}"
                                                    Style="{StaticResource MetricValue}" />
                                                <TextBlock
                                                    Text=" m"
                                                    Foreground="{StaticResource TextMuted}"
                                                    FontSize="9"
                                                    VerticalAlignment="Bottom"
                                                    Margin="1,0,0,1" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="2,0,0,2"
                                        Padding="8,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="SPEED"
                                                Style="{StaticResource MetricLabel}" />
                                            <StackPanel
                                                Orientation="Horizontal"
                                                Margin="0,1,0,0">
                                                <TextBlock
                                                    Text="{Binding SelectedVehicle.Speed, StringFormat=F1}"
                                                    Style="{StaticResource MetricValue}" />
                                                <TextBlock
                                                    Text=" m/s"
                                                    Foreground="{StaticResource TextMuted}"
                                                    FontSize="9"
                                                    VerticalAlignment="Bottom"
                                                    Margin="1,0,0,1" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="0,0,2,0"
                                        Padding="8,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="HEADING"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.HeadingText}"
                                                Style="{StaticResource MetricValue}"
                                                Margin="0,1,0,0" />
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="2,0,0,0"
                                        Padding="8,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="MISSION"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.MissionStatus}"
                                                Foreground="{Binding SelectedVehicle.StatusAccentColor}"
                                                FontFamily="Consolas"
                                                FontSize="13"
                                                FontWeight="Bold"
                                                Margin="0,1,0,0" />
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>

                                <!-- 배터리 -->
                                <Border
                                    Style="{StaticResource PanelBorder}"
                                    Padding="8,6"
                                    Margin="0,0,0,4">
                                    <StackPanel>
                                        <Grid
                                            Margin="0,0,0,3">
                                            <TextBlock
                                                Text="BATTERY"
                                                Style="{StaticResource MetricLabel}" />
                                            <StackPanel
                                                Orientation="Horizontal"
                                                HorizontalAlignment="Right">
                                                <TextBlock
                                                    Text="{Binding SelectedVehicle.BatteryWarningText}"
                                                    FontSize="9"
                                                    FontWeight="Bold"
                                                    Foreground="{StaticResource AccentRed}"
                                                    Margin="0,0,6,0"
                                                    Visibility="{Binding SelectedVehicle.BatteryWarningVisibility}" />
                                                <TextBlock
                                                    Text="{Binding SelectedVehicle.Battery, StringFormat={}{0:F0}%}"
                                                    FontSize="11"
                                                    FontWeight="Bold"
                                                    Foreground="{Binding SelectedVehicle.BatteryColor}" />
                                            </StackPanel>
                                        </Grid>
                                        <ProgressBar
                                            Value="{Binding SelectedVehicle.Battery}"
                                            Maximum="100"
                                            Height="7"
                                            Background="#1A2535"
                                            Foreground="{Binding SelectedVehicle.BatteryColor}"
                                            BorderThickness="0" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- 비행 통계 -->
                    <Border
                        Grid.Row="1"
                        BorderBrush="#1E3A5F"
                        BorderThickness="1,0,0,1"
                        Padding="13,10">
                        <StackPanel>
                            <TextBlock
                                Text="FLIGHT STATS"
                                Style="{StaticResource SectionHeader}"
                                Margin="0,0,0,8" />
                            <TextBlock
                                Text="— 드론을 선택하세요 —"
                                FontSize="10"
                                Foreground="{StaticResource TextMuted}"
                                Visibility="{Binding NoSelectionVisibility}" />
                            <StackPanel
                                Visibility="{Binding SelectedVehicleVisibility}">
                                <UniformGrid
                                    Columns="3">
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="0,0,2,2"
                                        Padding="7,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="DIST"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.TotalDistanceText}"
                                                FontFamily="Consolas"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource AccentCyan}"
                                                Margin="0,2,0,0" />
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="2,0,2,2"
                                        Padding="7,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="MAX ALT"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.MaxAltitudeText}"
                                                FontFamily="Consolas"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource AccentCyan}"
                                                Margin="0,2,0,0" />
                                        </StackPanel>
                                    </Border>
                                    <Border
                                        Style="{StaticResource PanelBorder}"
                                        Margin="2,0,0,2"
                                        Padding="7,6">
                                        <StackPanel>
                                            <TextBlock
                                                Text="AVG SPD"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.AvgSpeedText}"
                                                FontFamily="Consolas"
                                                FontSize="12"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource AccentCyan}"
                                                Margin="0,2,0,0" />
                                        </StackPanel>
                                    </Border>
                                </UniformGrid>
                                <!-- 좌표 -->
                                <Border
                                    Style="{StaticResource PanelBorder}"
                                    Margin="0,4,0,0"
                                    Padding="8,6">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition
                                                Width="*" />
                                            <ColumnDefinition
                                                Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock
                                                Text="LATITUDE"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.Latitude, StringFormat=F5}"
                                                FontFamily="Consolas"
                                                FontSize="11"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource AccentCyan}"
                                                Margin="0,2,0,0" />
                                        </StackPanel>
                                        <StackPanel
                                            Grid.Column="1">
                                            <TextBlock
                                                Text="LONGITUDE"
                                                Style="{StaticResource MetricLabel}" />
                                            <TextBlock
                                                Text="{Binding SelectedVehicle.Longitude, StringFormat=F5}"
                                                FontFamily="Consolas"
                                                FontSize="11"
                                                FontWeight="Bold"
                                                Foreground="{StaticResource AccentCyan}"
                                                Margin="0,2,0,0" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- ALERTS -->
                    <Border
                        Grid.Row="2"
                        BorderBrush="#1E3A5F"
                        BorderThickness="1,0,0,1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition
                                    Height="30" />
                                <RowDefinition
                                    Height="*" />
                            </Grid.RowDefinitions>
                            <Border
                                Grid.Row="0"
                                Background="#080B0F"
                                Padding="12,0">
                                <Grid
                                    VerticalAlignment="Center">
                                    <TextBlock
                                        Text="ALERTS"
                                        Style="{StaticResource SectionHeader}"
                                        VerticalAlignment="Center" />
                                    <StackPanel
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Right">
                                        <Button
                                            Content="EXPORT"
                                            Margin="0,0,6,0"
                                            Style="{StaticResource ConnectBtn}"
                                            Background="#1A2535"
                                            FontSize="8"
                                            Padding="5,2"
                                            Command="{Binding ExportAlertsCommand}"
                                            VerticalAlignment="Center" />
                                        <Border
                                            VerticalAlignment="Center"
                                            Background="{StaticResource AccentRed}"
                                            CornerRadius="8"
                                            Padding="6,1"
                                            Visibility="{Binding AlertBadgeVisibility}">
                                            <TextBlock
                                                Text="{Binding AlertCount}"
                                                FontSize="9"
                                                FontWeight="Bold"
                                                Foreground="White" />
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            <ScrollViewer
                                Grid.Row="1"
                                VerticalScrollBarVisibility="Auto">
                                <ItemsControl
                                    ItemsSource="{Binding Alerts}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border
                                                Margin="0,1,0,0"
                                                Padding="11,7"
                                                BorderThickness="3,0,0,0"
                                                BorderBrush="{Binding AlertColor}"
                                                Background="#0D1520">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition
                                                            Height="Auto" />
                                                        <RowDefinition
                                                            Height="Auto" />
                                                        <RowDefinition
                                                            Height="Auto" />
                                                    </Grid.RowDefinitions>
                                                    <Grid
                                                        Grid.Row="0">
                                                        <TextBlock
                                                            Text="{Binding Title}"
                                                            FontSize="10"
                                                            FontWeight="Bold"
                                                            Foreground="{Binding AlertColor}" />
                                                        <TextBlock
                                                            Text="{Binding Time}"
                                                            HorizontalAlignment="Right"
                                                            FontSize="8"
                                                            Foreground="{StaticResource TextMuted}" />
                                                    </Grid>
                                                    <TextBlock
                                                        Grid.Row="1"
                                                        Text="{Binding Message}"
                                                        FontSize="9"
                                                        Foreground="{StaticResource TextSecondary}"
                                                        Margin="0,2,0,0"
                                                        TextWrapping="Wrap" />
                                                    <TextBlock
                                                        Grid.Row="2"
                                                        Text="{Binding UnitId}"
                                                        FontSize="8"
                                                        Foreground="{StaticResource TextMuted}"
                                                        Margin="0,2,0,0" />
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- SYSTEM LOG -->
                    <Border
                        Grid.Row="3"
                        BorderBrush="#1E3A5F"
                        BorderThickness="1,0,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition
                                    Height="30" />
                                <RowDefinition
                                    Height="*" />
                            </Grid.RowDefinitions>
                            <Border
                                Grid.Row="0"
                                Background="#080B0F"
                                Padding="12,0">
                                <Grid
                                    VerticalAlignment="Center">
                                    <TextBlock
                                        Text="SYSTEM LOG"
                                        Style="{StaticResource SectionHeader}"
                                        VerticalAlignment="Center" />
                                    <Button
                                        Content="CLEAR"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Command="{Binding ClearLogCommand}"
                                        Style="{StaticResource ConnectBtn}"
                                        Background="#1A2535"
                                        Foreground="{StaticResource TextSecondary}"
                                        Padding="7,2"
                                        FontSize="9" />
                                </Grid>
                            </Border>
                            <ScrollViewer
                                Grid.Row="1"
                                VerticalScrollBarVisibility="Auto"
                                Background="#080B0F">
                                <ItemsControl
                                    ItemsSource="{Binding LogEntries}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid
                                                Margin="10,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition
                                                        Width="55" />
                                                    <ColumnDefinition
                                                        Width="38" />
                                                    <ColumnDefinition
                                                        Width="*" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock
                                                    Grid.Column="0"
                                                    Text="{Binding Time}"
                                                    FontSize="8"
                                                    Foreground="{StaticResource TextMuted}" />
                                                <TextBlock
                                                    Grid.Column="1"
                                                    Text="{Binding Level}"
                                                    FontSize="8"
                                                    FontWeight="Bold"
                                                    Foreground="{Binding LevelColor}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    Text="{Binding Message}"
                                                    FontSize="8"
                                                    Foreground="{StaticResource TextSecondary}"
                                                    TextWrapping="Wrap" />
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- ===== STATUS BAR ===== -->
            <Border
                Grid.Row="2"
                Background="#060810"
                BorderBrush="#1E3A5F"
                BorderThickness="0,1,0,0">
                <Grid
                    Margin="12,0">
                    <StackPanel
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                        <TextBlock
                            Text="AIRGUARD v2.0"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}" />
                        <Rectangle
                            Width="1"
                            Height="10"
                            Fill="#1E3A5F"
                            Margin="8,0" />
                        <TextBlock
                            Text="{Binding TotalReceived}"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}" />
                        <Rectangle
                            Width="1"
                            Height="10"
                            Fill="#1E3A5F"
                            Margin="8,0" />
                        <TextBlock
                            Text="{Binding DataRate}"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}" />
                        <Rectangle
                            Width="1"
                            Height="10"
                            Fill="#1E3A5F"
                            Margin="8,0" />
                        <TextBlock
                            Text="{Binding SessionDuration}"
                            FontSize="8"
                            Foreground="{StaticResource TextMuted}" />
                    </StackPanel>
                    <TextBlock
                        Text="{Binding StatusText}"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        FontSize="8"
                        Foreground="{StaticResource TextSecondary}" />
                </Grid>
            </Border>
        </Grid>

        <!-- ===== 긴급 플래시 오버레이 ===== -->
        <Border
            Background="{Binding FlashOverlayBrush}"
            Visibility="{Binding FlashOverlayVisibility}"
            IsHitTestVisible="False" />
    </Grid>
</Window>
